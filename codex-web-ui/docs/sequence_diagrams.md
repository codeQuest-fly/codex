# Codex Web UI 时序图

## 任务创建和执行时序图

```
用户界面        后端API         数据库          Codex服务       Codex CLI       WebSocket
   |               |              |                |               |               |
   |--创建任务请求->|              |                |               |               |
   |               |--保存任务信息->|                |               |               |
   |               |<-返回任务ID---|                |               |               |
   |<-返回任务ID---|               |                |               |               |
   |               |--执行任务请求->|                |               |               |
   |               |              |                |--启动Codex CLI->|               |
   |               |              |                |               |--输出开始---->|
   |               |              |                |               |               |--状态更新-->|
   |               |              |                |<-持续输出------|               |
   |               |<-任务状态更新-|                |               |               |
   |               |              |<-更新任务状态---|               |               |
   |               |              |                |               |               |--输出更新-->|
   |<-WebSocket更新|               |                |               |               |
   |               |              |                |               |--请求交互---->|
   |               |              |                |               |               |--交互请求-->|
   |<-交互请求-----|               |                |               |               |
   |--用户响应----->|               |                |               |               |
   |               |--转发用户响应->|                |               |               |
   |               |              |                |--发送用户响应-->|               |
   |               |              |                |               |--继续执行---->|
   |               |              |                |               |               |--状态更新-->|
   |<-WebSocket更新|               |                |               |               |
   |               |              |                |               |--任务完成---->|
   |               |              |                |<-返回结果------|               |
   |               |<-任务完成通知-|                |               |               |
   |               |              |<-更新任务状态---|               |               |
   |               |              |                |               |               |--状态更新-->|
   |<-WebSocket更新|               |                |               |               |
   |               |              |                |               |               |
```

## 文件浏览和编辑时序图

```
用户界面        后端API         文件系统
   |               |              |
   |--请求文件列表->|              |
   |               |--读取目录结构->|
   |               |<-返回文件列表-|
   |<-返回文件列表--|              |
   |               |              |
   |--请求文件内容->|              |
   |               |--读取文件内容->|
   |               |<-返回文件内容-|
   |<-返回文件内容--|              |
   |               |              |
   |--保存文件内容->|              |
   |               |--写入文件内容->|
   |               |<-写入成功-----|
   |<-保存成功-----|              |
   |               |              |
```

## 任务变更审批时序图

```
用户界面        后端API         数据库          文件系统
   |               |              |                |
   |--请求任务详情->|              |                |
   |               |--查询任务信息->|                |
   |               |<-返回任务信息-|                |
   |<-返回任务详情--|              |                |
   |               |              |                |
   |--批准文件变更->|              |                |
   |               |--更新变更状态->|                |
   |               |<-状态更新成功-|                |
   |               |--应用文件变更->|                |
   |               |              |                |--写入文件-->|
   |               |              |                |<-写入成功---|
   |<-变更应用成功--|              |                |
   |               |              |                |
```

## 任务中断和回滚时序图

```
用户界面        后端API         数据库          Codex服务       文件系统
   |               |              |                |               |
   |--中断任务请求->|              |                |               |
   |               |--更新任务状态->|                |               |
   |               |<-状态更新成功-|                |               |
   |               |--中断Codex进程->|               |               |
   |               |              |                |--终止进程---->|
   |               |<-进程已终止--|                |               |
   |<-任务已中断---|              |                |               |
   |               |              |                |               |
   |--回滚任务请求->|              |                |               |
   |               |--更新任务状态->|                |               |
   |               |<-状态更新成功-|                |               |
   |               |--获取变更列表->|                |               |
   |               |<-返回变更列表-|                |               |
   |               |              |                |               |--恢复文件-->|
   |               |              |                |               |<-恢复成功---|
   |<-任务已回滚---|              |                |               |
   |               |              |                |               |
```